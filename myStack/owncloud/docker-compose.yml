version: "2.0"

services:
  database:
    image: arm32v7/postgres
    environment:
      POSTGRES_PASSWORD: postgres
    volumes:
      - /mnt/pi3/nextcloud/database:/var/lib/postgresql/data
    networks:
      - owncloud-data
    labels:
      traefik.enable: "false"
    restart: always

  owncloud:
    build: .
    environment:
      POSTGRES_DB: postgres
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_HOST: database
    volumes:
      - /mnt/pi3/nextcloud/data:/var/www/html/data 
      - /mnt/pi3/nextcloud/config:/var/www/html/config 
      - /mnt/pi3/nextcloud/apps:/var/www/html/apps
      - /mnt/pi3/nextcloud/theme:/var/www/html/themes
    links:
      - "database"
    networks:
      - main_middle
      - owncloud-data
    labels:
      traefik.port: "80"
      traefik.frontend.rule: "Host:cloud.thibbo.duckdns.org"
      traefik.backend: "owncloud"
      traefik.docker.network: "main_middle"
    restart: always

#  owncloud-cron:
#    build: ../../myImages/rpi-owncloud-cron
#    networks:
#      - owncloud-data
#    labels:
#      traefik.enable: "false"
#    links:
#      - "owncloud:owncloud-cron"
#    tty: true
    
networks:
  owncloud-data:
  main_middle:
    external: true
